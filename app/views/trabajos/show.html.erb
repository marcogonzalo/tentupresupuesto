<%- model_class = Trabajo -%>
<% content_for :head do %>
  <%= stylesheet_link_tag 'trabajos' %>
<% end %>
<% 
  content_for :title do 
    @trabajo.proposito
  end
%>
<article id="solicitud-trabajo">
<%= render :partial => 'trabajos/cabecera', :locals => {:trabajo => @trabajo, :cantidad_presupuestos => @trabajo.presupuestos.size} %>
  <section id="descripcion">
    <%= @trabajo.descripcion %>
  </section>
  <% if @trabajo.contratado %>
  <section id="contratado">
    <h2>Proveedor contratado</h2>
    <div class="presupuesto">
      <span class="proveedor-contratado"><%= @trabajo.contratado.nombre_empresa %></span><%= raw mostrar_reputacion(@trabajo.contratado.reputacion, @trabajo.contratado.valoraciones, "general") %>
    </div>
  </section>
  <% end %>
  <% # No se muestra si el trabajo fue asignado y era el unico proveedor
  unless (@trabajo.presupuestos.size == 1 and @trabajo.contratado) or @trabajo.presupuestos.size < 1 %>
  <section id="proveedores-interesados">
    <h2>Proveedores interesados</h2>
    <%= render(:partial => 'presupuestos/info_en_trabajo', :collection => @trabajo.presupuestos, :as => :p, :locals => {:contratado => @trabajo.contratado, :es_el_solicitante => @es_el_solicitante}) or 'No hay presupuestos presentados.' %>
  </section>
  <% end %>
</article>
<footer class="form-actions">
<% if @es_el_solicitante %>
  <%= link_to t('.back', :default => t("helpers.links.back")),
              trabajos_path, :class => 'btn' %>
  <%= link_to t('.edit', :default => t("helpers.links.edit")),
              edit_trabajo_path(@trabajo), :class => 'btn' %>
  <%= link_to t('.destroy', :default => t("helpers.links.destroy")),
              trabajo_path(@trabajo),
              :method => 'delete',
              :confirm => t('.confirm', :default => t("helpers.links.confirm", :default => '¿Estás seguro de eliminar la oferta?')),
              :class => 'btn btn-danger' %>
<% elsif proveedor_signed_in? %>
  <%= link_to t('.new', :default => "Ofrecer presupuesto"),
              new_trabajo_presupuesto_path(@trabajo), :class => 'btn btn-primary' %>
<% end %>
</footer>
