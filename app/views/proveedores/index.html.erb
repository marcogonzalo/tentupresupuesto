<%- model_class = Proveedor -%>
<%
  content_for :head do
    stylesheet_link_tag 'reputacion', 'categorias', 'proveedores'
  end

  content_for :title do
    "Listado de solicitudes"
  end

  #  content_for :foot do
  #    javascript_include_tag 'trabajos'
  #  end
%>
<h1 class="page-header"><%= t '.title', :default => model_class.model_name.human.pluralize %></h1>
<div class="span6">
	<div id="filtros" class="well">
		<% unless signed_in?  %>
		<%= link_to "¿Provees algún servicio?", new_trabajo_path, :class => 'btn btn-warning btn-block con-myriad-bold'%>
		<br>
		<% end %>
		<h4>Categorías</h4>
		<div class="listado">
			<ul class=" nav nav-list">
				<li>
					<%= link_to "Todas", trabajos_path, :class => "con-myriad-bold" %>
				</li>
				<% for cat in Categoria.find(:all) %>
				<li>
					<%= link_to cat.nombre, listar_proveedores_path('categoria', cat.friendly_id) %>
				</li>
				<% end %>
			</ul>
		</div>
		<br>
		<h4>Ubicación</h4>
		<div class="listado">
			<ul class=" nav nav-list">
				<li>
					<%= link_to "Todas", trabajos_path, :class => "con-myriad-bold" %>
				</li>
				<% for ug in UbicacionGeografica.where(:tipo => 'estado', :entidad_id => 1) %>
				<li>
					<%= link_to ug.nombre, listar_proveedores_path('ubicacion', ug.friendly_id) %>
				</li>
				<% end %>
			</ul>
		</div>
		<br>
		<h4>Tipo de empresa</h4>
		<div class="listado">
			<ul class=" nav nav-list">
				<li>
					<%= link_to "Todos", trabajos_path, :class => "con-myriad-bold" %>
				</li>
				<% for emp in Proveedor::TIPO_EMPRESA %>
				<li>
					<%= link_to t('activerecord.attributes.proveedor.tipos_proveedor.'+emp), listar_proveedores_path('tipo', emp) %>
				</li>
				<% end %>
			</ul>
		</div>
	</div>
</div>
<div class="offset1 span15">
<% if not @categoria.nil? %>
	<h2 class="page-header"><%= @categoria.nombre+" ("+@cant_resultados.to_s+")" %></h2>
<% elsif not @tipo.nil? %>
	<h2 class="page-header"><%= t('activerecord.attributes.proveedor.tipos_proveedor.'+@tipo)+" ("+@cant_resultados.to_s+")" %></h2>
<% elsif not @ubicacion.nil? %>
	<h2 class="page-header"><%= @ubicacion.tipo.humanize+" "+@ubicacion.nombre+" ("+@cant_resultados.to_s+")" %></h2>
<% else %>
	<h2 class="page-header">Todos los proveedores</h2>
<% end %>
<% if @cant_resultados > 0 %>
	<% @proveedores.each do |proveedor| %>
	<div class="row proveedor ">
		<h3> <%= link_to proveedor.nombre_empresa, proveedor %> </h3>
		<%= image_tag(proveedor.avatar.micro.url) if proveedor.avatar? %>
		<section class="datos-proveedor">
			<p> <%= link_to t('activerecord.attributes.proveedor.tipos_proveedor.'+proveedor.tipo_proveedor), listar_proveedores_path('tipo', proveedor.tipo_proveedor) %> | 
				En <%= link_to proveedor.localidad.nombre, listar_proveedores_path('ubicacion', proveedor.localidad.friendly_id) %>, Municipio <%= link_to proveedor.municipio.nombre, listar_proveedores_path('ubicacion', proveedor.municipio.friendly_id) %>, Estado <%= link_to proveedor.estado.nombre, listar_proveedores_path('ubicacion', proveedor.estado.friendly_id) %>.
			</p>
			<%= raw mostrar_reputacion(proveedor.reputacion, proveedor.valoraciones, "proveedor") %>
		</section>
		<p class="descripcion">
			<%= truncate(proveedor.descripcion, :length => 150, :separator => ' ') %>
		</p>
	</div>
	<% end %>
<% else %>
	<p class="text-muted">
		No se hallaron proveedores con el criterio seleccionado.
	</p>
<% end %>
</div>